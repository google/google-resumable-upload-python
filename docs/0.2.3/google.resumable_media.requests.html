

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>google.resumable_media.requests &mdash; google-resumable-media 0.2.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="google-resumable-media 0.2.3 documentation" href="index.html"/>
        <link rel="next" title="google.resumable_media.requests.download module" href="google.resumable_media.requests.download.html"/>
        <link rel="prev" title="google.resumable_media.common module" href="google.resumable_media.common.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> google-resumable-media
          

          
          </a>

          
            
            
              <div class="version">
                0.2.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="google.resumable_media.common.html">google.resumable_media.common module</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><code class="docutils literal"><span class="pre">google.resumable_media.requests</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#authorized-transport">Authorized Transport</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simple-downloads">Simple Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="#chunked-downloads">Chunked Downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simple-uploads">Simple Uploads</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multipart-uploads">Multipart Uploads</a></li>
<li class="toctree-l2"><a class="reference internal" href="#resumable-uploads">Resumable Uploads</a></li>
<li class="toctree-l2"><a class="reference internal" href="google.resumable_media.requests.download.html">google.resumable_media.requests.download module</a></li>
<li class="toctree-l2"><a class="reference internal" href="google.resumable_media.requests.upload.html">google.resumable_media.requests.upload module</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">google-resumable-media</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li><code class="docutils literal"><span class="pre">google.resumable_media.requests</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/google.resumable_media.requests.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-google.resumable_media.requests">
<span id="google-resumable-media-requests"></span><h1><code class="docutils literal"><span class="pre">google.resumable_media.requests</span></code><a class="headerlink" href="#module-google.resumable_media.requests" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal"><span class="pre">requests</span></code> utilities for Google Media Downloads and Resumable Uploads.</p>
<p>This sub-package assumes callers will use the <a class="reference external" href="http://docs.python-requests.org/">requests</a> library
as transport and <a class="reference external" href="https://google-auth.readthedocs.io/">google-auth</a> for sending authenticated HTTP traffic
with <code class="docutils literal"><span class="pre">requests</span></code>.</p>
<div class="section" id="authorized-transport">
<h2>Authorized Transport<a class="headerlink" href="#authorized-transport" title="Permalink to this headline">¶</a></h2>
<p>To use <code class="docutils literal"><span class="pre">google-auth</span></code> and <code class="docutils literal"><span class="pre">requests</span></code> to create an authorized transport
that has read-only access to Google Cloud Storage (GCS):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">google.auth</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">google.auth.transport.requests</span> <span class="k">as</span> <span class="nn">tr_requests</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ro_scope</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;https://www.googleapis.com/auth/devstorage.read_only&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">credentials</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">google</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">scopes</span><span class="o">=</span><span class="p">(</span><span class="n">ro_scope</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transport</span> <span class="o">=</span> <span class="n">tr_requests</span><span class="o">.</span><span class="n">AuthorizedSession</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">transport</span>
<span class="go">&lt;google.auth.transport.requests.AuthorizedSession object at 0x...&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="simple-downloads">
<h2>Simple Downloads<a class="headerlink" href="#simple-downloads" title="Permalink to this headline">¶</a></h2>
<p>To download an object from Google Cloud Storage, construct the media URL
for the GCS object and download it with an authorized transport that has
access to the resource:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">google.resumable_media.requests</span> <span class="k">import</span> <span class="n">Download</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url_template</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="sa">u</span><span class="s1">&#39;https://www.googleapis.com/download/storage/v1/b/&#39;</span>
<span class="gp">... </span>    <span class="sa">u</span><span class="s1">&#39;</span><span class="si">{bucket}</span><span class="s1">/o/</span><span class="si">{blob_name}</span><span class="s1">?alt=media&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">media_url</span> <span class="o">=</span> <span class="n">url_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">blob_name</span><span class="o">=</span><span class="n">blob_name</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span> <span class="o">=</span> <span class="n">Download</span><span class="p">(</span><span class="n">media_url</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">finished</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span>
<span class="go">&lt;Response [200]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span>
<span class="go">&#39;1364156&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="go">1364156</span>
</pre></div>
</div>
<p>To download only a portion of the bytes in the object,
specify <code class="docutils literal"><span class="pre">start</span></code> and <code class="docutils literal"><span class="pre">end</span></code> byte positions (both optional):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">download</span> <span class="o">=</span> <span class="n">Download</span><span class="p">(</span><span class="n">media_url</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">8191</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">finished</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span>
<span class="go">&lt;Response [206]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span>
<span class="go">&#39;4096&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Content-Range&#39;</span><span class="p">]</span>
<span class="go">&#39;bytes 4096-8191/1364156&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="go">4096</span>
</pre></div>
</div>
</div>
<div class="section" id="chunked-downloads">
<h2>Chunked Downloads<a class="headerlink" href="#chunked-downloads" title="Permalink to this headline">¶</a></h2>
<p>For very large objects or objects of unknown size, it may make more sense
to download the object in chunks rather than all at once. This can be done
to avoid dropped connections with a poor internet connection or can allow
multiple chunks to be downloaded in parallel to speed up the total
download.</p>
<p>A <a class="reference internal" href="google.resumable_media.requests.download.html#google.resumable_media.requests.download.ChunkedDownload" title="google.resumable_media.requests.download.ChunkedDownload"><code class="xref py py-class docutils literal"><span class="pre">ChunkedDownload</span></code></a> uses the same media URL and authorized
transport that a basic <a class="reference internal" href="google.resumable_media.requests.download.html#google.resumable_media.requests.download.Download" title="google.resumable_media.requests.download.Download"><code class="xref py py-class docutils literal"><span class="pre">Download</span></code></a> would use, but also
requires a chunk size and a write-able byte <code class="docutils literal"><span class="pre">stream</span></code>. The chunk size is used
to determine how much of the resouce to consume with each request and the
stream is to allow the resource to be written out (e.g. to disk) without
having to fit in memory all at once.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">google.resumable_media.requests</span> <span class="k">import</span> <span class="n">ChunkedDownload</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">50</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>  <span class="c1"># 50MB</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span> <span class="o">=</span> <span class="n">ChunkedDownload</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">media_url</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Check the state of the download before starting.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">bytes_downloaded</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">total_bytes</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">consume_next_chunk</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Check the state of the download after consuming one chunk.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">finished</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">bytes_downloaded</span>  <span class="c1"># chunk_size</span>
<span class="go">52428800</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">total_bytes</span>  <span class="c1"># 1GB</span>
<span class="go">1073741824</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span>
<span class="go">&lt;Response [206]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span>
<span class="go">&#39;52428800&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Content-Range&#39;</span><span class="p">]</span>
<span class="go">&#39;bytes 0-52428799/1073741824&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">==</span> <span class="n">chunk_size</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">29</span><span class="p">)</span>
<span class="go">b&#39;The beginning of the chunk...&#39;</span>
</pre></div>
</div>
<p>The download will change it’s <code class="docutils literal"><span class="pre">finished</span></code> status to <a class="reference external" href="https://docs.python.org/3.6/library/constants.html#True" title="(in Python v3.6)"><code class="xref py py-data docutils literal"><span class="pre">True</span></code></a>
once the final chunk is consumed. In some cases, the final chunk may
not be the same size as the other chunks:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># The state of the download in progress.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">finished</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">bytes_downloaded</span>  <span class="c1"># 20 chunks at 50MB</span>
<span class="go">1048576000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">total_bytes</span>  <span class="c1"># 1GB</span>
<span class="go">1073741824</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">consume_next_chunk</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The state of the download after consuming the final chunk.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">finished</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">download</span><span class="o">.</span><span class="n">bytes_downloaded</span> <span class="o">==</span> <span class="n">download</span><span class="o">.</span><span class="n">total_bytes</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span>
<span class="go">&lt;Response [206]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span>
<span class="go">&#39;25165824&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Content-Range&#39;</span><span class="p">]</span>
<span class="go">&#39;bytes 1048576000-1073741823/1073741824&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">download</span><span class="o">.</span><span class="n">chunk_size</span>
<span class="go">True</span>
</pre></div>
</div>
<p>In addition, a <a class="reference internal" href="google.resumable_media.requests.download.html#google.resumable_media.requests.download.ChunkedDownload" title="google.resumable_media.requests.download.ChunkedDownload"><code class="xref py py-class docutils literal"><span class="pre">ChunkedDownload</span></code></a> can also take optional
<code class="docutils literal"><span class="pre">start</span></code> and <code class="docutils literal"><span class="pre">end</span></code> byte positions.</p>
</div>
<div class="section" id="simple-uploads">
<h2>Simple Uploads<a class="headerlink" href="#simple-uploads" title="Permalink to this headline">¶</a></h2>
<p>Among the three supported upload classes, the simplest is
<a class="reference internal" href="google.resumable_media.requests.upload.html#google.resumable_media.requests.upload.SimpleUpload" title="google.resumable_media.requests.upload.SimpleUpload"><code class="xref py py-class docutils literal"><span class="pre">SimpleUpload</span></code></a>. A simple upload should be used when the resource
being uploaded is small and when there is no metadata (other than the name)
associated with the resource.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">google.resumable_media.requests</span> <span class="k">import</span> <span class="n">SimpleUpload</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url_template</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="sa">u</span><span class="s1">&#39;https://www.googleapis.com/upload/storage/v1/b/</span><span class="si">{bucket}</span><span class="s1">/o?&#39;</span>
<span class="gp">... </span>    <span class="sa">u</span><span class="s1">&#39;uploadType=media&amp;&#39;</span>
<span class="gp">... </span>    <span class="sa">u</span><span class="s1">&#39;name=</span><span class="si">{blob_name}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload_url</span> <span class="o">=</span> <span class="n">url_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">blob_name</span><span class="o">=</span><span class="n">blob_name</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span> <span class="o">=</span> <span class="n">SimpleUpload</span><span class="p">(</span><span class="n">upload_url</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;Some not too large content.&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">content_type</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;text/plain&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">upload</span><span class="o">.</span><span class="n">transmit</span><span class="p">(</span><span class="n">transport</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span><span class="o">.</span><span class="n">finished</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span>
<span class="go">&lt;Response [200]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_response</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;bucket&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">bucket</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_response</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">blob_name</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_response</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;contentType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">content_type</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_response</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;md5Hash&#39;</span><span class="p">]</span>
<span class="go">&#39;M0XLEsX9/sMdiI+4pB4CAQ==&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">int</span><span class="p">(</span><span class="n">json_response</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;size&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>In the rare case that an upload fails, an <a class="reference internal" href="google.resumable_media.common.html#google.resumable_media.common.InvalidResponse" title="google.resumable_media.common.InvalidResponse"><code class="xref py py-exc docutils literal"><span class="pre">InvalidResponse</span></code></a>
will be raised:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span> <span class="o">=</span> <span class="n">SimpleUpload</span><span class="p">(</span><span class="n">upload_url</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">upload</span><span class="o">.</span><span class="n">transmit</span><span class="p">(</span><span class="n">transport</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
<span class="gp">... </span><span class="k">except</span> <span class="n">resumable_media</span><span class="o">.</span><span class="n">InvalidResponse</span> <span class="k">as</span> <span class="n">caught_exc</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">error</span> <span class="o">=</span> <span class="n">caught_exc</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">error</span>
<span class="go">InvalidResponse(&#39;Request failed with status code&#39;, 503,</span>
<span class="go">                &#39;Expected one of&#39;, &lt;HTTPStatus.OK: 200&gt;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">error</span><span class="o">.</span><span class="n">response</span>
<span class="go">&lt;Response [503]&gt;</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span><span class="o">.</span><span class="n">finished</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Even in the case of failure, we see that the upload is
<a class="reference internal" href="google.resumable_media.requests.upload.html#google.resumable_media.requests.upload.SimpleUpload.finished" title="google.resumable_media.requests.upload.SimpleUpload.finished"><code class="xref py py-attr docutils literal"><span class="pre">finished</span></code></a>, i.e. it cannot be re-used.</p>
</div>
<div class="section" id="multipart-uploads">
<h2>Multipart Uploads<a class="headerlink" href="#multipart-uploads" title="Permalink to this headline">¶</a></h2>
<p>After the simple upload, the <a class="reference internal" href="google.resumable_media.requests.upload.html#google.resumable_media.requests.upload.MultipartUpload" title="google.resumable_media.requests.upload.MultipartUpload"><code class="xref py py-class docutils literal"><span class="pre">MultipartUpload</span></code></a> can be used to
achieve essentially the same task. However, a multipart upload allows some
metadata about the resource to be sent along as well. (This is the “multi”:
we send a first part with the metadata and a second part with the actual
bytes in the resource.)</p>
<p>Usage is similar to the simple upload, but <a class="reference internal" href="google.resumable_media.requests.upload.html#google.resumable_media.requests.upload.MultipartUpload.transmit" title="google.resumable_media.requests.upload.MultipartUpload.transmit"><code class="xref py py-meth docutils literal"><span class="pre">transmit()</span></code></a>
accepts an extra required argument: <code class="docutils literal"><span class="pre">metadata</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">google.resumable_media.requests</span> <span class="k">import</span> <span class="n">MultipartUpload</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url_template</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="sa">u</span><span class="s1">&#39;https://www.googleapis.com/upload/storage/v1/b/</span><span class="si">{bucket}</span><span class="s1">/o?&#39;</span>
<span class="gp">... </span>    <span class="sa">u</span><span class="s1">&#39;uploadType=multipart&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload_url</span> <span class="o">=</span> <span class="n">url_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span> <span class="o">=</span> <span class="n">MultipartUpload</span><span class="p">(</span><span class="n">upload_url</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="sa">u</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">blob_name</span><span class="p">,</span>
<span class="gp">... </span>    <span class="sa">u</span><span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="gp">... </span>        <span class="sa">u</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;grurple&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="p">},</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">upload</span><span class="o">.</span><span class="n">transmit</span><span class="p">(</span><span class="n">transport</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span><span class="o">.</span><span class="n">finished</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span>
<span class="go">&lt;Response [200]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_response</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_response</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;bucket&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">bucket</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_response</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">blob_name</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_response</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metadata</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;metadata&#39;</span><span class="p">]</span>
<span class="go">True</span>
</pre></div>
</div>
<p>As with the simple upload, in the case of failure an <a class="reference internal" href="google.resumable_media.common.html#google.resumable_media.common.InvalidResponse" title="google.resumable_media.common.InvalidResponse"><code class="xref py py-exc docutils literal"><span class="pre">InvalidResponse</span></code></a>
is raised, enclosing the <a class="reference internal" href="google.resumable_media.common.html#google.resumable_media.common.InvalidResponse.response" title="google.resumable_media.common.InvalidResponse.response"><code class="xref py py-attr docutils literal"><span class="pre">response</span></code></a> that caused
the failure and the <code class="docutils literal"><span class="pre">upload</span></code> object cannot be re-used after a failure.</p>
</div>
<div class="section" id="resumable-uploads">
<h2>Resumable Uploads<a class="headerlink" href="#resumable-uploads" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference internal" href="google.resumable_media.requests.upload.html#google.resumable_media.requests.upload.ResumableUpload" title="google.resumable_media.requests.upload.ResumableUpload"><code class="xref py py-class docutils literal"><span class="pre">ResumableUpload</span></code></a> deviates from the other two upload classes:
it transmits a resource over the course of multiple requests. This
is intended to be used in cases where:</p>
<ul class="simple">
<li>the size of the resource is not known (i.e. it is generated on the fly)</li>
<li>requests must be short-lived</li>
<li>the client has request <strong>size</strong> limitations</li>
<li>the resource is too large to fit into memory</li>
</ul>
<p>In general, a resource should be sent in a <strong>single</strong> request to avoid
latency and reduce QPS. See <a class="reference external" href="https://cloud.google.com/storage/docs/best-practices#uploading">GCS best practices</a> for more things to
consider when using a resumable upload.</p>
<p>After creating a <a class="reference internal" href="google.resumable_media.requests.upload.html#google.resumable_media.requests.upload.ResumableUpload" title="google.resumable_media.requests.upload.ResumableUpload"><code class="xref py py-class docutils literal"><span class="pre">ResumableUpload</span></code></a> instance, a
<strong>resumable upload session</strong> must be initiated to let the server know that
a series of chunked upload requests will be coming and to obtain an
<code class="docutils literal"><span class="pre">upload_id</span></code> for the session. In contrast to the other two upload classes,
<a class="reference internal" href="google.resumable_media.requests.upload.html#google.resumable_media.requests.upload.ResumableUpload.initiate" title="google.resumable_media.requests.upload.ResumableUpload.initiate"><code class="xref py py-meth docutils literal"><span class="pre">initiate()</span></code></a> takes a byte <code class="docutils literal"><span class="pre">stream</span></code> as input rather
than raw bytes as <code class="docutils literal"><span class="pre">data</span></code>. This can be a file object, a <a class="reference external" href="https://docs.python.org/3.6/library/io.html#io.BytesIO" title="(in Python v3.6)"><code class="xref py py-class docutils literal"><span class="pre">BytesIO</span></code></a>
object or any other stream implementing the same interface.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">google.resumable_media.requests</span> <span class="k">import</span> <span class="n">ResumableUpload</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url_template</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="sa">u</span><span class="s1">&#39;https://www.googleapis.com/upload/storage/v1/b/</span><span class="si">{bucket}</span><span class="s1">/o?&#39;</span>
<span class="gp">... </span>    <span class="sa">u</span><span class="s1">&#39;uploadType=resumable&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload_url</span> <span class="o">=</span> <span class="n">url_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>  <span class="c1"># 1MB</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span> <span class="o">=</span> <span class="n">ResumableUpload</span><span class="p">(</span><span class="n">upload_url</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The upload doesn&#39;t know how &quot;big&quot; it is until seeing a stream.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span><span class="o">.</span><span class="n">total_bytes</span> <span class="ow">is</span> <span class="kc">None</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="sa">u</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">blob_name</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">upload</span><span class="o">.</span><span class="n">initiate</span><span class="p">(</span><span class="n">transport</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">content_type</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span>
<span class="go">&lt;Response [200]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span><span class="o">.</span><span class="n">resumable_url</span> <span class="o">==</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Location&#39;</span><span class="p">]</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span><span class="o">.</span><span class="n">total_bytes</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;X-GUploader-UploadID&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload_id</span>
<span class="go">&#39;ABCdef189XY_super_serious&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span><span class="o">.</span><span class="n">resumable_url</span> <span class="o">==</span> <span class="n">upload_url</span> <span class="o">+</span> <span class="sa">u</span><span class="s1">&#39;&amp;upload_id=&#39;</span> <span class="o">+</span> <span class="n">upload_id</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Once a <a class="reference internal" href="google.resumable_media.requests.upload.html#google.resumable_media.requests.upload.ResumableUpload" title="google.resumable_media.requests.upload.ResumableUpload"><code class="xref py py-class docutils literal"><span class="pre">ResumableUpload</span></code></a> has been initiated, the resource is
transmitted in chunks until completion:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">response0</span> <span class="o">=</span> <span class="n">upload</span><span class="o">.</span><span class="n">transmit_next_chunk</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response0</span>
<span class="go">&lt;Response [308]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span><span class="o">.</span><span class="n">finished</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span><span class="o">.</span><span class="n">bytes_uploaded</span> <span class="o">==</span> <span class="n">upload</span><span class="o">.</span><span class="n">chunk_size</span>
<span class="go">True</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response1</span> <span class="o">=</span> <span class="n">upload</span><span class="o">.</span><span class="n">transmit_next_chunk</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response1</span>
<span class="go">&lt;Response [308]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span><span class="o">.</span><span class="n">finished</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span><span class="o">.</span><span class="n">bytes_uploaded</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">upload</span><span class="o">.</span><span class="n">chunk_size</span>
<span class="go">True</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response2</span> <span class="o">=</span> <span class="n">upload</span><span class="o">.</span><span class="n">transmit_next_chunk</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response2</span>
<span class="go">&lt;Response [200]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span><span class="o">.</span><span class="n">finished</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">upload</span><span class="o">.</span><span class="n">bytes_uploaded</span> <span class="o">==</span> <span class="n">upload</span><span class="o">.</span><span class="n">total_bytes</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_response</span> <span class="o">=</span> <span class="n">response2</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_response</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;bucket&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">bucket</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json_response</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">blob_name</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="toctree-wrapper compound">
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="google.resumable_media.requests.download.html" class="btn btn-neutral float-right" title="google.resumable_media.requests.download module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="google.resumable_media.common.html" class="btn btn-neutral" title="google.resumable_media.common module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Google.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.2.3',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>